<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Tower</title>
    <link rel="apple-touch-icon" sizes="57x57" href="media/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="media/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="media/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="media/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="media/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="media/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="media/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="media/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="media/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="media/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="media/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/favicons/favicon-16x16.png">
    <link rel="manifest" href="media/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ff4500">
    <meta name="msapplication-TileImage" content="media/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ff4500">
    <link rel="stylesheet" href="style.css">
    <script type="module" src="modules/index.js"></script>
</head>
<body>
    <main>
        <img src="media/img/logo-inverse.jpg">
        <h2>Loading...</h2>
    </main>

    <dialog>
        <h2></h2>
    </dialog>

    <template id="splash">
        <style>
            .out button {
                transition: 0.25s;
                transform: scale(0);
            }
            .out img {
                transition: scale 5s;
                scale: 1.25;
            }
            .out2 img:first-of-type {
                transition: translate 1s;
                translate: 0 -200%;
            }
            .out2 img:last-of-type {
                transition: translate 1s;
                translate: 0 200%;
            }
        </style>
        <img src="media/img/Dark-Tower-Cover.jpg" alt="Dark Tower box cover">
        <button class="big">Play</button>
        <img src="media/img/player-gradient.png" alt="Player silhouette">
        <script>
        {
            document.querySelector("button").addEventListener("click", () => {
                document.body.className = "out";
                dt.media.audio.intro.addEventListener("ended", () => {
                    document.body.classList.add("out2");
                    dt.media.audio.whirrbeep.play();
                    setTimeout(() => {
                        dt.loadScreen("getPlayers");
                    }, 1000);
                }, { once: true });
                dt.media.audio.intro.play();
            }, { once: true });
        }
        </script>
    </template>
    <template id="getPlayers">
        <style>
            h2 {
                translate: 0 -200%;
            }
            h2 ~ * {
                translate: 0 100vh;
            }
            ul {
                padding: 0;
                list-style-type: none;
                max-height: 60vh;
                overflow-y: auto;
            }
            input {
                display: block;
                width: 90%;
                margin: 1em auto;
                padding: 0.5em;
                border-radius: 0.5em;
            }
            
            .in h2 {
                animation: slidein 2s forwards;
            }
            .in h2 ~ * {
                animation: slidein 1s forwards;
            }
            @keyframes slidein {
                to { translate: 0 0; }
            }
        </style>
        <h2>Players</h2>
        <ul>
            <li><input placeholder="player 1 name"></li>
        </ul>
        <button>Add player</button>
        <button class="big bottom" disabled>Start!</button>
        <script>
        {
            document.body.className = "in";
            const [addPlayer, start] = document.querySelectorAll("button");
            const ul = document.querySelector("ul");
            const firstPlayer = document.querySelector("input");
            setTimeout(() => { firstPlayer.focus(); }, 1000);
            firstPlayer.addEventListener("input", () => {
                if (firstPlayer.value) start.removeAttribute("disabled");
                else start.setAttribute("disabled", true);
            });
            addPlayer.addEventListener("click", () => {
                dt.media.audio.click.play();
                const nextNum = ul.childElementCount + 1;
                const li = document.createElement("li");
                li.innerHTML = `<input placeholder="player ${nextNum} name">`;
                ul.append(li);
                ul.querySelector("li:last-of-type input").focus();
            });
            start.addEventListener("click", () => {
                const playerNames = [...document.querySelectorAll("input")].map(i => i.value.trim()).filter(i => i.length);
                if (!playerNames.length) {
                    dt.error("There must be at least one player!");
                    return;
                }
                if ((new Set(playerNames)).size < playerNames.length) {
                    dt.error("Cannot have players with the same name!");
                    return;
                }
                dt.media.audio.end_turn.play();
                dt.playerNames = playerNames;
                if (playerNames.length > 1) dt.loadScreen("getFirstPlayer");
                else dt.loadScreen("singlePlayerNotes");
            });
        }
        </script>
    </template>
    <template id="getFirstPlayer">
        <button class="small">◂ Back</button>
        <img src="media/img/logo-inverse.jpg">
        <h2>Who plays first?</h2>
        <menu>
            <button class="big bottom">Randomize</button>
        </menu>
        <script>
        {
            const buttons = dt.playerNames.map(player => {
                let button = document.createElement("button");
                button.textContent = player;
                return button;
            });
            document.querySelector("menu").append(...buttons);
        }
        </script>
    </template>
    <template id="singlePlayerNotes">
        <style>
            ul {
                height: 40vh;
                overflow: auto;
            }
        </style>
        <button class="small">◂ Back</button>
        <img src="media/img/logo-inverse.jpg">
        <h2>Single-player version</h2>
        <ul>
            <li>Many players can play simultaneously, each using this single-player version. Be sure that all players finish each turn before starting a new one.</li>
            <li>The <strong>Cursed</strong> event is a random event out in the wilds around the Dark Tower instead of being instigated by another player.</li>
            <li>The <strong>Wizard</strong> joins your party and wards away a single <strong>Cursed</strong> event before departing. This interaction is identical to the way the <strong>Sword</strong> defeats the next <strong>Dragon</strong> appearance.</li>
        </ul>
        <button class="big bottom">Play</button>
        <script>
        {
            document.querySelector("button").addEventListener("click", () => {

            });
        }
        </script>
    </template>
</body>
</html>